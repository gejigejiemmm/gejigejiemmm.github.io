<!DOCTYPE html>
<html lang="en"><meta charset="utf-8"><meta name="generator" content="Hugo 0.64.1" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark"><title>Shiroçš„ å…¥é—¨å­¦ä¹ &nbsp;&ndash;&nbsp;gejigejiemmm</title><link rel="stylesheet" href="/css/core.min.a5d63d306fa53cba7bcef6c96fd6b55a008ea5736acaf25aace71f2bd7b379b2d97257d9c332e405e82f4f6e980f8409.css" integrity="sha384-pdY9MG&#43;lPLp7zvbJb9a1WgCOpXNqyvJarOcfK9ezebLZclfZwzLkBegvT26YD4QJ"><body>
    <div class="base-body"><section id="header" class="site header">
    <div class="header wrap"><span class="header left-side"><a class="site home" href="/"><img class="site logo" src="/tomato.png" alt /><span class="site name">gejigejiemmm</span></a></span>
        <span class="header right-side"><div class="nav wrap"><nav class="nav"><a class="nav item" href="/categories/">Categories</a><a class="nav item" href="/tags/">Tags</a><a class="nav item" href="https://github.com/gejigejiemmm/"target="_blank">Github</a><a class="nav item" href="https://gohugo.io/"target="_blank">Hugo</a></nav></div></span></div><div class="site slogan"><span class="title">haloğŸ˜Š</span></div></section><div id="content"><div class="article-container"><section class="article header">
    <h1 class="article title">Shiroçš„ å…¥é—¨å­¦ä¹ </h1><p class="article date">Wednesday, February 26, 2020</p></section><article class="article markdown-body"><h2 id="shiroçš„åˆæ­¥å­¦ä¹ ">shiroçš„åˆæ­¥å­¦ä¹ </h2>
<p>shiro æ˜¯ä¸€ä¸ªæƒé™ç®¡ç†çš„æ¡†æ¶ï¼Œä¹‹å‰å°±å¬è¿‡ï¼Œä½†ä¸€ç›´æ²¡å­¦ä¹ ï¼Œå¯’å‡åœ¨å®¶è¿˜ä¸å¼€å­¦ï¼Œå®åœ¨ç©ä¸ä¸‹å»äº†ï¼Œæ¥å­¦ä¸ªè¿™ç©ç©</p>
<h2 id="å¿«é€Ÿæ„å»º">å¿«é€Ÿæ„å»º</h2>
<ul>
<li>é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªspringboot å·¥ç¨‹</li>
<li>ç„¶ååŠ å…¥shiro ç›¸å…³ä¾èµ–</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">        <span class="nt">&lt;dependency</span><span class="nt">&gt;</span>
            <span class="nt">&lt;groupId</span><span class="nt">&gt;</span>org.apache.shiro<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId</span><span class="nt">&gt;</span>shiro-spring-boot-web-starter<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version</span><span class="nt">&gt;</span>1.4.0<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
</code></pre></div><ul>
<li>åˆ›å»ºconfigæ–‡ä»¶è¿›è¡Œç›¸å…³é…ç½®
<ul>
<li>shiroä¸­æœ‰ä¸‰ä¸ªé‡è¦çš„ä¸œè¥¿</li>
<li>Subject:ç”¨æˆ·ä¸»ä½“ï¼ˆå…³è”SecurityManagerï¼ŒæŠŠæ“-ä½œäº¤ç»™SecurityManagerï¼‰</li>
<li>SecurityManagerï¼šå®‰å…¨ç®¡ç†å™¨ï¼ˆå…³è”Realmï¼‰</li>
<li>Realmï¼šshiroè¿æ¥æ•°æ®åº“çš„æ¡¥æ¢</li>
</ul>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ShiroConfig</span> <span class="o">{</span>
    <span class="cm">/**
</span><span class="cm">     * åˆ›å»º ShiroFilterFactoryBean
</span><span class="cm">     */</span>
    <span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;shiroFilterFactoryBean&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">ShiroFilterFactoryBean</span> <span class="nf">getShiroFilterFactoryBean</span><span class="o">(</span><span class="nd">@Qualifier</span><span class="o">(</span><span class="s">&#34;securityManager&#34;</span><span class="o">)</span> <span class="n">DefaultWebSecurityManager</span> <span class="n">securityManager</span><span class="o">)</span><span class="o">{</span>
        <span class="n">ShiroFilterFactoryBean</span> <span class="n">shiroFilterFactoryBean</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ShiroFilterFactoryBean</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="c1">//è®¾ç½®å®‰å…¨ç®¡ç†å™¨
</span><span class="c1"></span>        <span class="n">shiroFilterFactoryBean</span><span class="o">.</span><span class="na">setSecurityManager</span><span class="o">(</span><span class="n">securityManager</span><span class="o">)</span><span class="o">;</span>

        <span class="k">return</span> <span class="n">shiroFilterFactoryBean</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * åˆ›å»ºDefaultWebSecurityManager
</span><span class="cm">     *
</span><span class="cm">     * shiroä¸­securityManagerç”¨æ¥ç®¡æ¥ Realm
</span><span class="cm">     */</span>
    <span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;securityManager&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">DefaultWebSecurityManager</span> <span class="nf">getDefaultWebSecurityManager</span><span class="o">(</span><span class="nd">@Qualifier</span><span class="o">(</span><span class="s">&#34;userRealm&#34;</span><span class="o">)</span> <span class="n">UserRealm</span> <span class="n">userRealm</span><span class="o">)</span><span class="o">{</span>
        <span class="c1">//åˆ›å»ºç®¡ç†ç±»
</span><span class="c1"></span>        <span class="n">DefaultWebSecurityManager</span> <span class="n">securityManager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultWebSecurityManager</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>

        <span class="c1">//å…³è”realm
</span><span class="c1"></span>        <span class="n">securityManager</span><span class="o">.</span><span class="na">setRealm</span><span class="o">(</span><span class="n">userRealm</span><span class="o">)</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">securityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * åˆ›å»ºRealm
</span><span class="cm">     *
</span><span class="cm">     *
</span><span class="cm">     * å¯ä»¥è‡ªå®šä¹‰Realmç±»
</span><span class="cm">     */</span>
    <span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;userRealm&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">UserRealm</span> <span class="nf">getRealm</span><span class="o">(</span><span class="o">)</span><span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">UserRealm</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div><ul>
<li>åˆ›å»º realm</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserRealm</span> <span class="kd">extends</span> <span class="n">AuthorizingRealm</span> <span class="o">{</span>
    <span class="cm">/**
</span><span class="cm">     * æ‰§è¡Œæˆæƒé€»è¾‘
</span><span class="cm">     * @param principalCollection
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="n">AuthorizationInfo</span> <span class="nf">doGetAuthorizationInfo</span><span class="o">(</span><span class="n">PrincipalCollection</span> <span class="n">principalCollection</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;æ‰§è¡Œæˆæƒé€»è¾‘&#34;</span><span class="o">)</span><span class="o">;</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * æ‰§è¡Œè®¤è¯é€»è¾‘
</span><span class="cm">     * @param authenticationToken
</span><span class="cm">     * @return
</span><span class="cm">     * @throws AuthenticationException
</span><span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="n">AuthenticationInfo</span> <span class="nf">doGetAuthenticationInfo</span><span class="o">(</span><span class="n">AuthenticationToken</span> <span class="n">authenticationToken</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">AuthenticationException</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;æ‰§è¡Œè®¤è¯é€»è¾‘&#34;</span><span class="o">)</span><span class="o">;</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>è¿™ä¸ªæ—¶å€™è¿›å…¥htmlé¡µé¢è¿›è¡Œè®¿é—®æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯å¦‚æœShiroFilterFactoryBeanæ²¡æœ‰åŠ å…¥@Beanæ³¨è§£çš„è¯ï¼Œæ— è®ºä½ urlæ€ä¹ˆå†™ï¼Œéƒ½ä¼šè·³è½¬åˆ°login.jspé¡µé¢ï¼Œå¦‚æœå‡ºç°è¿™ç§æƒ…å†µï¼Œè®°å¾—æ£€æŸ¥è‡ªå·±çš„é…ç½®æ–‡ä»¶ã€‚</p>
<h2 id="ç®€å•çš„è®¤è¯ç®¡ç†">ç®€å•çš„è®¤è¯ç®¡ç†</h2>
<p>æ–°å»ºuser çš„add.html å’Œ update.html
ç„¶ååœ¨ controller é‡Œé¢ï¼ˆæˆ–è€…åœ¨webConfigä¸‹é…ç½®ä¹Ÿå¯ä»¥ï¼‰è¿›è¡Œç›¸å…³é…ç½®
åœ¨index.htmlä¸­ä½¿ç”¨è¶…é“¾æ¥æŒ‡å‘ è¿™ä¸¤ä¸ªæ–‡ä»¶</p>
<p>è¿™ä¸ªæ—¶å€™æ˜¯å¯ä»¥è¿›å…¥çš„ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡åœ¨ShiroConfigä¸­è¿˜æ²¡æ·»åŠ  Shiroå†…ç½®çš„è¿‡æ»¤å™¨</p>
<ul>
<li>å¸¸ç”¨çš„è¿‡æ»¤å™¨
<ul>
<li>anon: æ— éœ€è®¤è¯(ç™»å½•) å°±å¯ä»¥è®¿é—®</li>
<li>authc: å¿…é¡»è®¤è¯æ‰å¯ä»¥è®¿é—®</li>
<li>userï¼š rememberMe åå¯ä»¥è®¿é—®</li>
<li>role: è¯¥èµ„æºå¿…é¡»å¾—åˆ°è§’è‰²æƒé™æ‰å¯ä»¥è®¿é—®</li>
<li>perms: è¯¥èµ„æºå¿…é¡»å¾—åˆ°èµ„æºæƒé™æ‰å¯ä»¥è®¿é—®</li>
</ul>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">    <span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;shiroFilterFactoryBean&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">ShiroFilterFactoryBean</span> <span class="nf">getShiroFilterFactoryBean</span><span class="o">(</span><span class="nd">@Qualifier</span><span class="o">(</span><span class="s">&#34;securityManager&#34;</span><span class="o">)</span> <span class="n">DefaultWebSecurityManager</span> <span class="n">securityManager</span><span class="o">)</span><span class="o">{</span>
        <span class="n">ShiroFilterFactoryBean</span> <span class="n">shiroFilterFactoryBean</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ShiroFilterFactoryBean</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="c1">//è®¾ç½®å®‰å…¨ç®¡ç†å™¨
</span><span class="c1"></span>        <span class="n">shiroFilterFactoryBean</span><span class="o">.</span><span class="na">setSecurityManager</span><span class="o">(</span><span class="n">securityManager</span><span class="o">)</span><span class="o">;</span>

        <span class="c1">//æ·»åŠ shiroçš„å†…ç½®è¿‡æ»¤å™¨
</span><span class="c1"></span>        <span class="cm">/**
</span><span class="cm">         * shiroå†…ç½®è¿‡æ»¤å™¨
</span><span class="cm">         * ç”¨æ¥å¯¹ url æ‹¦æˆª
</span><span class="cm">         */</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">filterMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedHashMap</span><span class="o">&lt;</span><span class="o">&gt;</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>

        <span class="n">filterMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;/add&#34;</span><span class="o">,</span><span class="s">&#34;authc&#34;</span><span class="o">)</span><span class="o">;</span>
        <span class="n">filterMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;/update&#34;</span><span class="o">,</span><span class="s">&#34;authc&#34;</span><span class="o">)</span><span class="o">;</span>

        <span class="c1">//è°ƒæ•´ç™»å½•é¡µé¢ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸ºlogin.jsp
</span><span class="c1"></span>        <span class="n">shiroFilterFactoryBean</span><span class="o">.</span><span class="na">setLoginUrl</span><span class="o">(</span><span class="s">&#34;/login&#34;</span><span class="o">)</span><span class="o">;</span>


        <span class="n">shiroFilterFactoryBean</span><span class="o">.</span><span class="na">setFilterChainDefinitionMap</span><span class="o">(</span><span class="n">filterMap</span><span class="o">)</span><span class="o">;</span>


        <span class="k">return</span> <span class="n">shiroFilterFactoryBean</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></div><p>è¿™ä¸ªæ—¶å€™å†è®¿é—® /add.html,/update.html å°±ä¼šå‘ç°è‡ªåŠ¨é‡å®šå‘åˆ°äº† login.html</p>
<h4 id="å¦‚æœéœ€è¦ç™»å½•éªŒè¯çš„è¯-ä¿®æ”¹realm">å¦‚æœéœ€è¦ç™»å½•éªŒè¯çš„è¯ ä¿®æ”¹Realm</h4>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">    <span class="kd">protected</span> <span class="n">AuthenticationInfo</span> <span class="nf">doGetAuthenticationInfo</span><span class="o">(</span><span class="n">AuthenticationToken</span> <span class="n">authenticationToken</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">AuthenticationException</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;æ‰§è¡Œè®¤è¯é€»è¾‘&#34;</span><span class="o">)</span><span class="o">;</span>


        <span class="n">UsernamePasswordToken</span> <span class="n">token</span> <span class="o">=</span> <span class="o">(</span><span class="n">UsernamePasswordToken</span><span class="o">)</span><span class="n">authenticationToken</span><span class="o">;</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">findUser</span><span class="o">(</span><span class="n">token</span><span class="o">.</span><span class="na">getUsername</span><span class="o">(</span><span class="o">)</span><span class="o">)</span><span class="o">;</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">user</span> <span class="o">=</span><span class="o">=</span> <span class="kc">null</span><span class="o">)</span><span class="o">{</span>
            <span class="c1">//å¦‚æœè¿”å› null  shiroä¼šå¸®æˆ‘ä»¬æŠ›å‡ºä¸€ä¸ª UnknownAccountException
</span><span class="c1"></span>            <span class="c1">//ä¹Ÿå°±æ˜¯ç”¨æˆ·ä¸å­˜åœ¨
</span><span class="c1"></span>            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="c1">//åˆ¤æ–­å¯†ç 
</span><span class="c1"></span>        <span class="c1">//SimpleAuthenticationInfo æ˜¯ AuthenticationInfoçš„å­ç±»
</span><span class="c1"></span>        <span class="k">return</span> <span class="k">new</span> <span class="n">SimpleAuthenticationInfo</span><span class="o">(</span><span class="n">user</span><span class="o">,</span><span class="n">user</span><span class="o">.</span><span class="na">getPassword</span><span class="o">(</span><span class="o">)</span><span class="o">,</span><span class="s">&#34;&#34;</span><span class="o">)</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></div><h2 id="ç®€å•çš„æˆæƒç®¡ç†">ç®€å•çš„æˆæƒç®¡ç†</h2>
<p>æœ‰çš„æ—¶å€™æˆ‘ä»¬éœ€è¦å¯¹ç‰¹å®šèµ„æºè¿›è¡Œæˆæƒï¼Œå½“ç™»å½•çš„ç”¨æˆ·æœ‰è¿™ä¸ªæƒé™çš„æ—¶å€™æ‰å…è®¸è®¿é—®ã€‚</p>
<p>æ¯”å¦‚è¯´ç°åœ¨æœ‰ä¸ªéœ€æ±‚æ˜¯
ä¸¤ä¸ªè´¦æˆ·haloå’Œtu
haloæ‹¥æœ‰insertæƒé™
tuæ‹¥æœ‰updateæƒé™</p>
<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨è¿‡æ»¤å™¨å¯¹ url æ·»åŠ æ‰€å¯¹åº”çš„æƒé™</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">    <span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;shiroFilterFactoryBean&#34;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">ShiroFilterFactoryBean</span> <span class="nf">getShiroFilterFactoryBean</span><span class="o">(</span><span class="nd">@Qualifier</span><span class="o">(</span><span class="s">&#34;securityManager&#34;</span><span class="o">)</span> <span class="n">DefaultWebSecurityManager</span> <span class="n">securityManager</span><span class="o">)</span><span class="o">{</span>
        <span class="n">ShiroFilterFactoryBean</span> <span class="n">shiroFilterFactoryBean</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ShiroFilterFactoryBean</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="c1">//è®¾ç½®å®‰å…¨ç®¡ç†å™¨
</span><span class="c1"></span>        <span class="n">shiroFilterFactoryBean</span><span class="o">.</span><span class="na">setSecurityManager</span><span class="o">(</span><span class="n">securityManager</span><span class="o">)</span><span class="o">;</span>

        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">filterMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedHashMap</span><span class="o">&lt;</span><span class="o">&gt;</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>

        <span class="n">filterMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;/add&#34;</span><span class="o">,</span><span class="s">&#34;authc&#34;</span><span class="o">)</span><span class="o">;</span>
        <span class="n">filterMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;/update&#34;</span><span class="o">,</span><span class="s">&#34;authc&#34;</span><span class="o">)</span><span class="o">;</span>


        <span class="c1">//è°ƒæ•´ç™»å½•é¡µé¢
</span><span class="c1"></span>        <span class="n">shiroFilterFactoryBean</span><span class="o">.</span><span class="na">setLoginUrl</span><span class="o">(</span><span class="s">&#34;/login&#34;</span><span class="o">)</span><span class="o">;</span>


        <span class="c1">//æˆæƒè¿‡æ»¤å™¨
</span><span class="c1"></span>        <span class="n">filterMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;/add&#34;</span><span class="o">,</span><span class="s">&#34;perms[user:add]&#34;</span><span class="o">)</span><span class="o">;</span>
        <span class="n">filterMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;/update&#34;</span><span class="o">,</span><span class="s">&#34;perms[user:update]&#34;</span><span class="o">)</span><span class="o">;</span>
        <span class="c1">//è®¾ç½®æœªæˆæƒçš„é¡µé¢
</span><span class="c1"></span>        <span class="n">shiroFilterFactoryBean</span><span class="o">.</span><span class="na">setUnauthorizedUrl</span><span class="o">(</span><span class="s">&#34;/noAuth&#34;</span><span class="o">)</span><span class="o">;</span>

        <span class="n">shiroFilterFactoryBean</span><span class="o">.</span><span class="na">setFilterChainDefinitionMap</span><span class="o">(</span><span class="n">filterMap</span><span class="o">)</span><span class="o">;</span>

        <span class="k">return</span> <span class="n">shiroFilterFactoryBean</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></div><p>ç„¶ååœ¨Realmä¸­ç¼–å†™ è®¤è¯é€»è¾‘
æ³¨æ„ï¼š
å¦‚æœä½ è¦é€šè¿‡ subject.getPrincipal() æ¥è·å–å½“å‰ç™»å½•çš„ç”¨æˆ·çš„è¯ï¼Œä½ éœ€è¦åœ¨ doGetAuthenticationInfoæ–¹æ³•ä¸­æœ€åä¿®æ”¹æˆ
ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ä½ è¦è¿”å›çš„å€¼
ç¬¬äºŒä¸ªå‚æ•°ç”¨æ¥éªŒè¯å¯†ç </p>
<p>return new SimpleAuthenticationInfo(user,user.getPassword(),&quot;&quot;);</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">    <span class="kd">protected</span> <span class="n">AuthorizationInfo</span> <span class="nf">doGetAuthorizationInfo</span><span class="o">(</span><span class="n">PrincipalCollection</span> <span class="n">principalCollection</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;æ‰§è¡Œæˆæƒé€»è¾‘&#34;</span><span class="o">)</span><span class="o">;</span>

        <span class="c1">//ç»™èµ„æºè¿›è¡Œæˆæƒ
</span><span class="c1"></span>        <span class="n">SimpleAuthorizationInfo</span> <span class="n">info</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleAuthorizationInfo</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="c1">//å¯¹ user:add è¿›è¡Œæˆæƒ
</span><span class="c1"></span><span class="c1">//        info.addStringPermission(&#34;user:add&#34;);
</span><span class="c1"></span>
        <span class="c1">//è·å–å½“å‰ç™»å½•çš„ç”¨æˆ·
</span><span class="c1"></span>        <span class="c1">//å…¶å®æˆ‘è§‰å¾—è¿™æ­¥æ²¡å¿…è¦ï¼Œåˆå»æ•°æ®åº“æŸ¥äº†ï¼Œè¾ƒå¥½çš„åšæ³•åº”è¯¥åœ¨ç™»å½•çš„æ—¶å€™å°±ä¸€æ¬¡æ€§æ‹¿å‡ºæƒé™
</span><span class="c1"></span>        <span class="n">Subject</span> <span class="n">subject</span> <span class="o">=</span> <span class="n">SecurityUtils</span><span class="o">.</span><span class="na">getSubject</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span> <span class="n">subject</span><span class="o">.</span><span class="na">getPrincipal</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>

        <span class="n">info</span><span class="o">.</span><span class="na">addStringPermission</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getPerms</span><span class="o">(</span><span class="o">)</span><span class="o">)</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">info</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></div><p>å¦‚æœæ²¡æœ‰æƒé™çš„è¯ï¼Œä¼šè·³è½¬åˆ°setUnauthorizedUrl()è®¾ç½®çš„  url</p>
</article><section class="article labels"><a class="category" href=/categories/java/>java</a><a class="tag" href=/tags/shiro/>shiro</a></section></div><section class="article navigation"><p><a class="link" href="/post/giligili-docker%E9%85%8D%E7%BD%AE/"><span class="li">&larr;</span>giligili docker-portainer é…ç½®</a></p><p><a class="link" href="/post/markdown%E5%AD%A6%E4%B9%A0/"><span class="li">&rarr;</span>Markdownå­¦ä¹ </a></p></section></div><section id="footer" class="footer"><div class="footer-wrap">
    <p class="copyright">Â©2020 gejigejiemmm.</p>
    <p class="powerby"><span>Powered by </span><a href="https://gohugo.io" 
        target="_blank">Hugo</a><span> and the </span><a href="https://themes.gohugo.io/hugo-notepadium/" 
        target="_blank">Notepadium</a></p>
</div></section></div>
</body>

</html>