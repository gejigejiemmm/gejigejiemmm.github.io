<!DOCTYPE html>
<html lang="en"><meta charset="utf-8"><meta name="generator" content="Hugo 0.64.1" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark"><title>java å¤šçº¿ç¨‹çš„å…¥é—¨å­¦ä¹ &nbsp;&ndash;&nbsp;gejigejiemmm</title><link rel="stylesheet" href="/css/core.min.a5d63d306fa53cba7bcef6c96fd6b55a008ea5736acaf25aace71f2bd7b379b2d97257d9c332e405e82f4f6e980f8409.css" integrity="sha384-pdY9MG&#43;lPLp7zvbJb9a1WgCOpXNqyvJarOcfK9ezebLZclfZwzLkBegvT26YD4QJ"><body>
    <div class="base-body"><section id="header" class="site header">
    <div class="header wrap"><span class="header left-side"><a class="site home" href="/"><img class="site logo" src="/tomato.png" alt /><span class="site name">gejigejiemmm</span></a></span>
        <span class="header right-side"><div class="nav wrap"><nav class="nav"><a class="nav item" href="/categories/">Categories</a><a class="nav item" href="/tags/">Tags</a><a class="nav item" href="https://github.com/gejigejiemmm/"target="_blank">Github</a><a class="nav item" href="https://gohugo.io/"target="_blank">Hugo</a></nav></div></span></div><div class="site slogan"><span class="title">haloğŸ˜Š</span></div></section><div id="content"><div class="article-container"><section class="article header">
    <h1 class="article title">java å¤šçº¿ç¨‹çš„å…¥é—¨å­¦ä¹ </h1><p class="article date">Wednesday, March 4, 2020</p></section><article class="article markdown-body"><h2 id="å¤šçº¿ç¨‹">å¤šçº¿ç¨‹</h2>
<h3 id="ç¨‹åºè¿›ç¨‹çº¿ç¨‹çš„åŸºæœ¬æ¦‚å¿µ">ç¨‹åºã€è¿›ç¨‹ã€çº¿ç¨‹çš„åŸºæœ¬æ¦‚å¿µ</h3>
<p>ç¨‹åº</p>
<p>æ˜¯ä¸ºäº†å®Œæˆç‰¹å®šçš„ä»»åŠ¡ï¼Œç”¨æŸç§è¯­è¨€ç¼–å†™çš„ä¸€ç»„æŒ‡ä»¤çš„é›†åˆã€‚å³æŒ‡ä¸€æ®µç‰¹å®šçš„é™æ€çš„ä»£ç ã€‚</p>
<p>è¿›ç¨‹</p>
<p>æ­£åœ¨è¿è¡Œä¸­çš„ç¨‹åºï¼Œï¼ˆç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼‰ï¼ŒåŠ è½½åœ¨å†…å­˜ä¸­ï¼Œæ“ä½œç³»ç»Ÿä¼šä¸ºè¿›ç¨‹åˆ†é…å†…å­˜ç©ºé—´ï¼Œæ˜¯åŠ¨æ€ï¼ˆäº¤æ¢æ•°æ®ï¼‰çš„ã€‚</p>
<p>çº¿ç¨‹</p>
<p>è¿›ç¨‹è¿›ä¸€æ­¥åˆ’åˆ†ä¸ºçº¿ç¨‹ï¼Œæ˜¯ç¨‹åºå†…éƒ¨çš„ä¸€æ¡æ‰§è¡Œè·¯å¾„ã€‚å¹¶è¡Œçš„å»æ‰§è¡Œå¤šæ¡çº¿ç¨‹ï¼Œç§°ä¹‹ä¸ºå¤šçº¿ç¨‹ã€‚
ï¼ˆæ–°å»ºä¸€æ¡çº¿ç¨‹ï¼šä¸»ç¨‹åºæ–°å¼€ä¸€æ¡çº¿ç¨‹ï¼Œå¹¶è¡Œçš„æ‰§è¡Œï¼‰</p>
<p>è¿›ç¨‹å’Œçº¿ç¨‹çš„å…³ç³»ï¼šä¸€ä¸ªè¿›ç¨‹å¯èƒ½ä¼šæœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„å†…å­˜èµ„æºã€‚</p>
<h3 id="çº¿ç¨‹çš„åˆ›å»ºå’Œä½¿ç”¨">çº¿ç¨‹çš„åˆ›å»ºå’Œä½¿ç”¨</h3>
<h4 id="1-å£°æ˜ä¸€ä¸ªç±»ç»§æ‰¿threadç±»é‡å†™runæ–¹æ³•">1. å£°æ˜ä¸€ä¸ªç±»ï¼Œç»§æ‰¿Threadç±»ï¼Œé‡å†™run()æ–¹æ³•</h4>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm"> * å¤šçº¿ç¨‹çš„åˆ›å»º
</span><span class="cm"> * æ–¹å¼ä¸€
</span><span class="cm"> * ç»§æ‰¿ Thread
</span><span class="cm"> * é‡å†™ runæ–¹æ³•
</span><span class="cm"> * è°ƒç”¨ startæ–¹æ³•å¯åŠ¨
</span><span class="cm"> *
</span><span class="cm"> * ä¾‹å­ï¼šéå†100ä»¥å†…çš„å¶æ•°
</span><span class="cm"> */</span>

<span class="c1">//1. ç»§æ‰¿ Thread ç±»
</span><span class="c1"></span><span class="kd">class</span> <span class="nc">MyThread</span> <span class="kd">extends</span> <span class="n">Thread</span><span class="o">{</span>

    <span class="c1">//2. é‡å†™ run æ–¹æ³•
</span><span class="c1"></span>    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span><span class="o">=</span> <span class="n">100</span><span class="o">;</span> <span class="n">i</span><span class="o">+</span><span class="o">+</span><span class="o">)</span><span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="n">2</span> <span class="o">=</span><span class="o">=</span> <span class="n">0</span><span class="o">)</span><span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">i</span><span class="o">+</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">(</span><span class="o">)</span><span class="o">.</span><span class="na">getName</span><span class="o">(</span><span class="o">)</span><span class="o">)</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreadTest</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[</span><span class="o">]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//3. åˆ›å»ºå¯¹è±¡
</span><span class="c1"></span>        <span class="n">MyThread</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyThread</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="c1">//4. å¼€å§‹çº¿ç¨‹
</span><span class="c1"></span>        <span class="n">t1</span><span class="o">.</span><span class="na">start</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>è°ƒç”¨start()æ–¹æ³•ä¼šè‡ªåŠ¨è°ƒç”¨è¯¥çº¿ç¨‹çš„run()æ–¹æ³•</p>
<p>é—®é¢˜1 ï¼šé‚£ä¹ˆèƒ½å¦ä¸è°ƒç”¨satrt()æ–¹æ³•,ç›´æ¥å»è°ƒç”¨run()æ–¹æ³•å‘¢ï¼Ÿ</p>
<p>ä¸å¯ä»¥ï¼ï¼ï¼ï¼</p>
<p>ç›´æ¥è°ƒç”¨run()æ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šè¿˜æ˜¯mainçº¿ç¨‹
Thread.currentThread().getName() å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•è·å–çº¿ç¨‹åå­—æµ‹è¯•ä¸€ä¸‹</p>
<p>é—®é¢˜2 ï¼š èƒ½ä½¿ç”¨startæ–¹æ³•ï¼Œå†åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å—ï¼Ÿ</p>
<p>ä¸å¯ä»¥ï¼ï¼ï¼ï¼ï¼
ä¸€ä¸ªçº¿ç¨‹åªèƒ½å¼€å¯ä¸€æ¬¡ï¼ŒäºŒæ¬¡è°ƒç”¨ start åˆ™ä¼šæŠ¥ java.lang.IllegalThreadStateException å¼‚å¸¸</p>
<h5 id="thread-çš„å¸¸è§æ–¹æ³•">Thread çš„å¸¸è§æ–¹æ³•</h5>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm"> * Thread çš„å¸¸ç”¨æ–¹æ³•
</span><span class="cm"> * 1. start() å¯åŠ¨çº¿ç¨‹
</span><span class="cm"> * 2. run() å½“å‰çº¿ç¨‹è¦æ‰§è¡Œçš„æ“ä½œ
</span><span class="cm"> * 3. getName() è·å–çº¿ç¨‹çš„åå­—
</span><span class="cm"> * 4. currentThread() é™æ€æ–¹æ³•ï¼Œè¿”å›å½“å‰æ‰§è¡Œçš„çº¿ç¨‹
</span><span class="cm"> * 5. setName() è®¾ç½®çº¿ç¨‹çš„åå­—
</span><span class="cm"> * 6. yield() é‡Šæ”¾cpuæ‰§è¡Œæƒ
</span><span class="cm"> * 7. join() çº¿ç¨‹aä¸­è°ƒç”¨çº¿ç¨‹bçš„joinæ–¹æ³•ï¼Œaè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°çº¿ç¨‹bæ‰§è¡Œå®Œæ¯•ï¼Œç„¶åaç»§ç»­æ‰§è¡Œ
</span><span class="cm"> * 8. stop() å¼ºåˆ¶çº¿ç¨‹ç»“æŸ,å·²è¿‡æ—¶
</span><span class="cm"> * 9. sleep() è®©å½“å‰çº¿ç¨‹é˜»å¡ç­‰å¾…å¤šå°‘ç§’
</span><span class="cm"> */</span>
</code></pre></div><h5 id="çº¿ç¨‹çš„ä¼˜å…ˆçº§">çº¿ç¨‹çš„ä¼˜å…ˆçº§</h5>
<p>getPriority() è·å–ä¼˜å…ˆçº§
setPriority() è®¾ç½®ä¼˜å…ˆçº§</p>
<p>ä¼˜å…ˆçº§:::</p>
<p>Thread.MAX_PRIORITY 10</p>
<p>Thread.NORM_PRIORITY 5 é»˜è®¤æƒ…å†µä¸‹</p>
<p>Thread.MAX_PRIORITY 1</p>
<h4 id="2-å®ç°runnableæ¥å£">2. å®ç°Runnableæ¥å£</h4>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm"> * åˆ›å»ºå¤šçº¿ç¨‹çš„æ–¹å¼äºŒï¼šå®ç°Runnable æ¥å£
</span><span class="cm"> * 1. åˆ›å»ºä¸€ä¸ªå®ç°Runnableæ¥å£çš„ç±»
</span><span class="cm"> * 2. å®ç°ç±»å»å®ç°Runnableæ¥å£çš„æŠ½è±¡æ–¹æ³•: run()
</span><span class="cm"> * 3. åˆ›å»ºå®ç°ç±»çš„å¯¹è±¡
</span><span class="cm"> * 4. å°†æ­¤å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’åˆ°Threadç±»çš„æ„é€ å™¨,åˆ›å»ºThreadç±»çš„å¯¹è±¡
</span><span class="cm"> * 5. è°ƒç”¨start()
</span><span class="cm"> */</span>
<span class="kd">class</span> <span class="nc">MThread</span> <span class="kd">implements</span> <span class="n">Runnable</span><span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">100</span><span class="o">;</span> <span class="n">i</span><span class="o">+</span><span class="o">+</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="n">2</span> <span class="o">=</span><span class="o">=</span> <span class="n">0</span><span class="o">)</span><span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">i</span><span class="o">)</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RunnableTest</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[</span><span class="o">]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">MThread</span> <span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MThread</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="c1">//è°ƒç”¨çš„æ˜¯å½“å‰çº¿ç¨‹çš„run --ã€‹(ä½†æ˜¯è°ƒç”¨äº†Runnableç±»å‹çš„runæ–¹æ³•ï¼‰
</span><span class="c1"></span>        <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">t1</span><span class="o">)</span><span class="o">.</span><span class="na">start</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h5 id="ä¸¤ç§æ–¹æ³•çš„æ¯”è¾ƒ">ä¸¤ç§æ–¹æ³•çš„æ¯”è¾ƒ</h5>
<p>Threadç±»å…¶å®ä¹Ÿå®ç°äº†Runnableæ¥å£ï¼Œæ‰€ä»¥æ¯”è¾ƒæ¨èç¬¬äºŒç§ï¼ŒåŒæ—¶ç¬¬äºŒç§æ–¹å¼ä¹Ÿæ‰“ç ´äº†extendsçš„å•ç»§æ‰¿æ€§</p>
<h3 id="çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ">çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ</h3>
<p>Thread.State çš„å˜é‡æŒ‡ä»£è¡¨çº¿ç¨‹çš„çŠ¶æ€</p>
<p>Newï¼šæ–°å»ºï¼Œå½“ä¸€ä¸ªThreadç±»æˆ–å…¶å­ç±»çš„å¯¹è±¡è¢«åˆ›å»ºæ—¶ï¼Œæ–°ç”Ÿçš„çº¿ç¨‹å¯¹è±¡å¤„äºæ–°å»ºçŠ¶æ€</p>
<p>å°±ç»ªï¼Œå½“çº¿ç¨‹è¢«satrt()åï¼Œå°†è¿›å…¥çº¿ç¨‹é˜Ÿåˆ—ç­‰å¾…cpuçš„è°ƒç”¨</p>
<p>è¿è¡Œï¼Œå½“cpuè°ƒç”¨è¯¥çº¿ç¨‹çš„æ—¶å€™</p>
<p>é˜»å¡ï¼Œå½“è¯¥çº¿ç¨‹è¢«äººä¸ºæŒ‚èµ·æˆ–æ‰§è¡Œè¾“å…¥è¾“å‡ºæ“ä½œæ—¶ï¼Œä¸­æ–­è‡ªå·±çš„æ‰§è¡Œï¼Œè®©å‡ºcpuæ§åˆ¶æƒ</p>
<p>æ­»äº¡ï¼Œçº¿ç¨‹å®Œæˆäº†è‡ªå·±çš„ä»»åŠ¡ï¼Œæˆ–è¢«å¼ºåˆ¶ç»“æŸï¼Œæˆ–å¼‚å¸¸é€€å‡ºåè¿›å…¥æ­»äº¡çŠ¶æ€</p>
<h3 id="çº¿ç¨‹çš„åŒæ­¥">çº¿ç¨‹çš„åŒæ­¥</h3>
<h4 id="çº¿ç¨‹çš„å®‰å…¨é—®é¢˜ä¸è§£å†³">çº¿ç¨‹çš„å®‰å…¨é—®é¢˜ä¸è§£å†³</h4>
<p>é—®é¢˜ï¼šå–ç¥¨è¿‡ç¨‹ä¸­å‡ºç°é‡ç¥¨ã€é”™ç¥¨&ndash;&gt;å‡ºç°äº†çº¿ç¨‹å®‰å…¨é—®é¢˜</p>
<p>é—®é¢˜å‡ºç°çš„åŸå› ï¼šå½“æŸä¸ªçº¿ç¨‹åœ¨æ“ä½œè½¦ç¥¨çš„è¿‡ç¨‹ä¸­ï¼Œå°šæœªæ“ä½œå®Œæˆï¼Œå…¶ä»–çº¿ç¨‹å‚ä¸è¿›æ¥ä¹Ÿæ“ä½œè½¦ç¥¨</p>
<p>è§£å†³ï¼šåœ¨ä¸€ä¸ªçº¿ç¨‹aåœ¨æ“ä½œticketçš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹ä¸èƒ½å‚ä¸è¿›æ¥ï¼Œç›´åˆ°çº¿ç¨‹aæ“ä½œå®Œticketä¹‹åï¼Œå…¶ä»–çº¿ç¨‹æ‰å¯ä»¥æ“ä½œticketã€‚
å³ä½¿çº¿ç¨‹aå‡ºç°äº†é˜»å¡ï¼Œä¹Ÿä¸èƒ½è¢«æ”¹å˜</p>
<p>åœ¨javaä¸­æˆ‘ä»¬é€šè¿‡åŒæ­¥æœºåˆ¶æ¥è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜</p>
<p>æ–¹å¼ä¸€ï¼šåŒæ­¥ä»£ç å—</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/*
</span><span class="cm">    synchronized(åŒæ­¥ç›‘è§†å™¨){
</span><span class="cm">        éœ€è¦è¢«åŒæ­¥çš„ä»£ç 
</span><span class="cm">    }   
</span><span class="cm">
</span><span class="cm">    è¯´æ˜ï¼š
</span><span class="cm">    1ã€‚æ“ä½œå…±äº«æ•°æ®çš„ä»£ç ï¼Œå³ä¸ºè¢«åŒæ­¥çš„ä»£ç 
</span><span class="cm">    2ã€‚å…±äº«æ•°æ®ï¼šå¤šä¸ªçº¿ç¨‹å…±åŒæ“ä½œçš„æ•°æ®
</span><span class="cm">    3ã€‚åŒæ­¥ç›‘è§†å™¨ï¼Œä¿—ç§°ï¼šé”ã€‚ä»»ä½•ä¸€ä¸ªç±»çš„å¯¹è±¡éƒ½å¯ä»¥å……å½“é”
</span><span class="cm">        è¦æ±‚ï¼šå¤šä¸ªçº¿ç¨‹å¿…é¡»å…±ç”¨åŒä¸€ä¸ªé”ï¼ˆåŒä¸€ä¸ªå¯¹è±¡ï¼‰
</span><span class="cm">*/</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WindowRunnableTest</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[</span><span class="o">]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">WindowRunnable</span> <span class="n">windowRunnable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WindowRunnable</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>

        <span class="n">Thread</span> <span class="n">window1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">windowRunnable</span><span class="o">)</span><span class="o">;</span>
        <span class="n">Thread</span> <span class="n">window2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">windowRunnable</span><span class="o">)</span><span class="o">;</span>
        <span class="n">Thread</span> <span class="n">window3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">windowRunnable</span><span class="o">)</span><span class="o">;</span>

        <span class="n">window1</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&#34;çª—å£1&#34;</span><span class="o">)</span><span class="o">;</span>
        <span class="n">window2</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&#34;çª—å£2&#34;</span><span class="o">)</span><span class="o">;</span>
        <span class="n">window3</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&#34;çª—å£3&#34;</span><span class="o">)</span><span class="o">;</span>

        <span class="n">window1</span><span class="o">.</span><span class="na">start</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="n">window2</span><span class="o">.</span><span class="na">start</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="n">window3</span><span class="o">.</span><span class="na">start</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>

    <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">WindowRunnable</span> <span class="kd">implements</span> <span class="n">Runnable</span><span class="o">{</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">ticket</span> <span class="o">=</span> <span class="n">100</span><span class="o">;</span>
    <span class="c1">//é”
</span><span class="c1"></span>    <span class="n">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span><span class="o">{</span>
            <span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">)</span><span class="o">{</span><span class="c1">//synchronized (obj) æˆ–è€…synchronized (WindowRunnable.class){ éƒ½å¯ä»¥
</span><span class="c1"></span>
                <span class="k">if</span><span class="o">(</span><span class="n">ticket</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span><span class="o">{</span>

                    <span class="k">try</span> <span class="o">{</span>
                        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">10</span><span class="o">)</span><span class="o">;</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
                    <span class="o">}</span>

                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">(</span><span class="o">)</span><span class="o">.</span><span class="na">getName</span><span class="o">(</span><span class="o">)</span><span class="o">+</span><span class="s">&#34;: å–ç¥¨ï¼Œç¥¨å·ä¸º&#34;</span><span class="o">+</span><span class="n">ticket</span><span class="o">)</span><span class="o">;</span>

                    <span class="n">ticket</span><span class="o">-</span><span class="o">-</span><span class="o">;</span>
                <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>æ–¹å¼äºŒï¼šåŒæ­¥æ–¹æ³•
å°†è¢«åŒæ­¥çš„ä»£ç æå–å‡ºæ¥å°è£…æˆä¸€ä¸ªæ–¹æ³•</p>
<pre><code>    //åŒæ­¥æ–¹æ³•ä¸­ï¼ŒåŒæ­¥ç›‘è§†å™¨ä¸ºthis
    //å¦‚æœåŒæ­¥æ–¹æ³•è¢«staticä¿®é¥° åŒæ­¥ç›‘è§†å™¨å°±ä¸ºç±»å.class
    private synchronized void show(){
        if(ticket &gt; 0){
            try {
                Thread.sleep(10);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }

            System.out.println(Thread.currentThread().getName()+&quot;: å–ç¥¨ï¼Œç¥¨å·ä¸º&quot;+ticket);

            ticket--;
        }
    }
</code></pre><p>å¥½å¤„ï¼šè§£å†³äº†çº¿ç¨‹çš„å®‰å…¨é—®é¢˜</p>
<p>åå¤„ï¼šè¿è¡Œæ…¢ï¼Œå˜æˆäº†ä¸²è¡Œï¼Œæ“ä½œåŒæ­¥ä»£ç æ—¶ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å‚ä¸ï¼Œç›¸å½“äºå•çº¿ç¨‹çš„è¿‡ç¨‹ï¼Œæœ‰å±€é™æ€§</p>
<h4 id="æ‡’æ±‰å¼çš„çº¿ç¨‹å®‰å…¨é—®é¢˜">æ‡’æ±‰å¼çš„çº¿ç¨‹å®‰å…¨é—®é¢˜</h4>
<h3 id="çº¿ç¨‹çš„é€šä¿¡">çº¿ç¨‹çš„é€šä¿¡</h3>
<p>çº¿ç¨‹é—´æœ‰çš„æ—¶å€™æ˜¯éœ€è¦é€šä¿¡çš„ï¼Œæ¯”å¦‚è¯´æœ€ç»å…¸çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜ï¼Œæ¶ˆè´¹è€…çœ‹åˆ°å•†å“é‡Œæ²¡æœ‰è´§ç‰©çš„æ—¶å€™
ï¼Œå°±ä¸å†å»è´­ä¹°è´§ç‰©äº†ï¼Œç”Ÿäº§è€…çœ‹åˆ°å•†åº—è´§ç‰©æ»¡äº†çš„æ—¶å€™ï¼Œå°±ä¸å†å»ç”Ÿäº§å•†å“äº†ï¼Œå‡è®¾ç°åœ¨æœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œ
ä¸€ä¸ªæ˜¯ç”Ÿäº§è€…çº¿ç¨‹ï¼Œä¸€ä¸ªæ˜¯æ¶ˆè´¹è€…çº¿ç¨‹ï¼Œé‚£ä¹ˆè°æ¥å‘Šè¯‰ä»–ä»¬å•†å“çš„æƒ…å†µå‘¢ï¼Ÿ</p>
<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨ï¼Œçº¿ç¨‹ä¸­çš„ä¸‰ä¸ªé€šä¿¡æ–¹æ³•æ¥è¿›è¡Œé€šä¿¡äº†</p>
<ul>
<li>wait()ï¼šä¸€æ—¦æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œçº¿ç¨‹è¿›å…¥é˜»å¡ï¼Œå¹¶ä¸”é‡Šæ”¾åŒæ­¥ç›‘è§†å™¨</li>
<li>notify()ï¼šä¸€æ—¦æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œä¼šå”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼Œå¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå”¤é†’ä¼˜å…ˆçº§æœ€é«˜çš„é‚£ä¸ª</li>
<li>notifyAll()ï¼šä¸€æ—¦æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œä¼šå”¤é†’æ‰€æœ‰çš„çº¿ç¨‹ã€‚</li>
<li>è¯´æ˜ï¼Œè¿™ä¸‰ä¸ªæ–¹æ³•ï¼Œåªèƒ½åœ¨åŒæ­¥ä»£ç å—ï¼Œæˆ–è€…åŒæ­¥æ–¹æ³•å½“ä¸­,Lockæœ‰è‡ªå·±çš„wait</li>
<li>å¿…é¡»ç”±åŒä¸€ä¸ªåŒæ­¥ç›‘è§†å™¨è°ƒç”¨ wait å’Œ notifyï¼Œå¦åˆ™ä¼šæŠ¥å¼‚å¸¸ java.lang.IllegalMonitorStateException</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm"> * ä¸¤ä¸ªçº¿ç¨‹å¾ªç¯æ‰“å° 1-100
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CommunicationTest</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[</span><span class="o">]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Number</span> <span class="n">number</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Number</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>

        <span class="n">Thread</span> <span class="n">thread1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">number</span><span class="o">)</span><span class="o">;</span>
        <span class="n">Thread</span> <span class="n">thread2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">number</span><span class="o">)</span><span class="o">;</span>

        <span class="n">thread1</span><span class="o">.</span><span class="na">start</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="n">thread2</span><span class="o">.</span><span class="na">start</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Number</span> <span class="kd">implements</span> <span class="n">Runnable</span><span class="o">{</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">number</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span><span class="o">{</span>

            <span class="kd">synchronized</span> <span class="o">(</span><span class="n">Number</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>

                <span class="c1">//å”¤é†’ä¸€ä¸ªçº¿ç¨‹
</span><span class="c1"></span>                <span class="n">Number</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">notify</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>

                <span class="c1">//å”¤é†’æ‰€æœ‰çº¿ç¨‹
</span><span class="c1"></span>                <span class="c1">//Number.class.notifyAll();
</span><span class="c1"></span>                <span class="k">if</span> <span class="o">(</span><span class="n">number</span> <span class="o">&lt;</span><span class="o">=</span> <span class="n">100</span><span class="o">)</span><span class="o">{</span>

                    <span class="k">try</span> <span class="o">{</span>
                        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">100</span><span class="o">)</span><span class="o">;</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
                    <span class="o">}</span>

                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">(</span><span class="o">)</span><span class="o">.</span><span class="na">getName</span><span class="o">(</span><span class="o">)</span><span class="o">+</span><span class="s">&#34;æ‰“å°ï¼š&#34;</span><span class="o">+</span><span class="n">number</span><span class="o">)</span><span class="o">;</span>
                    <span class="n">number</span><span class="o">+</span><span class="o">+</span><span class="o">;</span>

                    <span class="k">try</span> <span class="o">{</span>
                        <span class="c1">//ä»å°±ç»ªæ€è¿›å…¥é˜»å¡æ€ï¼Œè€Œä¸”ä¼šé‡Šæ”¾åŒæ­¥é”ï¼Œåªèƒ½ç”±å…¶ä»–çº¿ç¨‹å”¤é†’ã€‚
</span><span class="c1"></span>                        <span class="n">Number</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">wait</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
                    <span class="o">}</span>
                <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h5 id="ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜">ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜</h5>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm"> * ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductorAndCustomer</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[</span><span class="o">]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Clerk</span> <span class="n">clerk</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Clerk</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>

        <span class="n">Producer</span> <span class="n">producer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Producer</span><span class="o">(</span><span class="n">clerk</span><span class="o">)</span><span class="o">;</span>
        <span class="n">Consumer</span> <span class="n">Consumer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Consumer</span><span class="o">(</span><span class="n">clerk</span><span class="o">)</span><span class="o">;</span>

        <span class="n">Thread</span> <span class="n">thread</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">producer</span><span class="o">)</span><span class="o">;</span>
        <span class="n">Thread</span> <span class="n">thread1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">Consumer</span><span class="o">)</span><span class="o">;</span>

        <span class="n">thread</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&#34;ç”Ÿäº§è€…1&#34;</span><span class="o">)</span><span class="o">;</span>
        <span class="n">thread1</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&#34;æ¶ˆè´¹è€…1&#34;</span><span class="o">)</span><span class="o">;</span>

        <span class="n">thread</span><span class="o">.</span><span class="na">start</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="n">thread1</span><span class="o">.</span><span class="na">start</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>


    <span class="o">}</span>

<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Clerk</span><span class="o">{</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">productCount</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>

    <span class="c1">//ç”Ÿäº§äº§å“,æ­¤æ—¶åŒæ­¥ç›‘è§†å™¨æ˜¯ this
</span><span class="c1"></span>    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">produceProduct</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>

        <span class="k">if</span><span class="o">(</span><span class="n">productCount</span> <span class="o">&lt;</span> <span class="n">20</span><span class="o">)</span><span class="o">{</span>
            <span class="n">productCount</span><span class="o">+</span><span class="o">+</span><span class="o">;</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">(</span><span class="o">)</span><span class="o">.</span><span class="na">getName</span><span class="o">(</span><span class="o">)</span><span class="o">+</span><span class="s">&#34;:å¼€å§‹ç”Ÿäº§ç¬¬&#34;</span><span class="o">+</span><span class="n">productCount</span><span class="o">+</span><span class="s">&#34;ä¸ªäº§å“&#34;</span><span class="o">)</span><span class="o">;</span>

            <span class="n">notify</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>

        <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;ä»“åº“æ»¡20ä¸ª&#34;</span><span class="o">)</span><span class="o">;</span>
                <span class="n">wait</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">}</span>

    <span class="c1">//æ¶ˆè´¹äº§å“
</span><span class="c1"></span>    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">consumeProduct</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>

        <span class="k">if</span><span class="o">(</span><span class="n">productCount</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span><span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">(</span><span class="o">)</span><span class="o">.</span><span class="na">getName</span><span class="o">(</span><span class="o">)</span><span class="o">+</span><span class="s">&#34;:å¼€å§‹æ¶ˆè´¹ç¬¬&#34;</span><span class="o">+</span><span class="n">productCount</span><span class="o">+</span><span class="s">&#34;ä¸ªäº§å“&#34;</span><span class="o">)</span><span class="o">;</span>
            <span class="n">productCount</span><span class="o">-</span><span class="o">-</span><span class="o">;</span>

            <span class="n">notify</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;æ²¡æœ‰å•†å“äº†&#34;</span><span class="o">)</span><span class="o">;</span>
                <span class="n">wait</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">//ç”Ÿäº§è€…
</span><span class="c1"></span><span class="kd">class</span> <span class="nc">Producer</span> <span class="kd">implements</span> <span class="n">Runnable</span><span class="o">{</span>

    <span class="kd">private</span> <span class="n">Clerk</span> <span class="n">clerk</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Producer</span><span class="o">(</span><span class="n">Clerk</span> <span class="n">clerk</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">clerk</span> <span class="o">=</span> <span class="n">clerk</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">(</span><span class="o">)</span><span class="o">.</span><span class="na">getName</span><span class="o">(</span><span class="o">)</span><span class="o">+</span><span class="s">&#34;:å¼€å§‹ç”Ÿäº§&#34;</span><span class="o">)</span><span class="o">;</span>

        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span><span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">10</span><span class="o">)</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="n">clerk</span><span class="o">.</span><span class="na">produceProduct</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">//æ¶ˆè´¹è€…
</span><span class="c1"></span><span class="kd">class</span> <span class="nc">Consumer</span> <span class="kd">implements</span> <span class="n">Runnable</span><span class="o">{</span>

    <span class="kd">private</span> <span class="n">Clerk</span> <span class="n">clerk</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Consumer</span><span class="o">(</span><span class="n">Clerk</span> <span class="n">clerk</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">clerk</span> <span class="o">=</span> <span class="n">clerk</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">(</span><span class="o">)</span><span class="o">.</span><span class="na">getName</span><span class="o">(</span><span class="o">)</span><span class="o">+</span><span class="s">&#34;:å¼€å§‹æ¶ˆè´¹&#34;</span><span class="o">)</span><span class="o">;</span>
        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span><span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">10</span><span class="o">)</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="n">clerk</span><span class="o">.</span><span class="na">consumeProduct</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="o">}</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h3 id="jdk-50-æ–°å¢çš„åˆ›å»ºå¤šçº¿ç¨‹çš„æ–¹å¼">jdk 5.0 æ–°å¢çš„åˆ›å»ºå¤šçº¿ç¨‹çš„æ–¹å¼</h3>
<h4 id="callable">Callable</h4>
<p>åˆ›å»ºå¤šçº¿ç¨‹çš„ç¬¬ä¸‰ç§æ–¹å¼ï¼Œå®ç°Callable æ¥å£
è¿™ä¸­æ–¹å¼è¾ƒä¹‹å‰å®ç°Runnable çš„æ–¹å¼ç›¸æ¯”ã€‚å¤šäº†è¿”å›å€¼
ä½†æ˜¯éœ€è¦çŸ¥é“ï¼ŒCallableå¹¶ä¸æ˜¯Thread çš„å­ç±»ï¼Œæ‰€ä»¥ï¼Œæƒ³è¦å¯åŠ¨çš„è¯ï¼Œéœ€è¦å€ŸåŠ© Futureæ¥å£
Future æ¥å£ä¸­æœ‰å”¯ä¸€çš„å®ç°ç±» FutureTaskï¼ŒåŒæ—¶FutureTaskä¹Ÿå®ç°äº†Runnableæ¥å£</p>
<p>Callable çš„ä¼˜ç‚¹</p>
<ul>
<li>å¯ä»¥è¿”å›å€¼</li>
<li>å¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼Œè¢«å¤–é¢çš„æ“ä½œæ•è·</li>
<li>æ”¯æŒèŒƒå‹</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CallableNewThread</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[</span><span class="o">]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">NewThread</span> <span class="n">newThread</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NewThread</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>

        <span class="n">FutureTask</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">futureTask</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FutureTask</span><span class="o">&lt;</span><span class="o">&gt;</span><span class="o">(</span><span class="n">newThread</span><span class="o">)</span><span class="o">;</span>

        <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">futureTask</span><span class="o">)</span><span class="o">.</span><span class="na">start</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="c1">//futuretask çš„getæ–¹æ³•ä¼šå»è°ƒç”¨-&gt;æ„é€ å‚æ•°ä¼ å…¥çš„å¯¹è±¡çš„callï¼ˆå›è°ƒï¼‰æ–¹æ³•
</span><span class="c1"></span>            <span class="n">Integer</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">futureTask</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">sum</span><span class="o">)</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ExecutionException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="o">}</span>

    <span class="o">}</span>
<span class="o">}</span>


<span class="kd">class</span> <span class="nc">NewThread</span> <span class="kd">implements</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">call</span><span class="o">(</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">100</span><span class="o">;</span> <span class="n">i</span><span class="o">+</span><span class="o">+</span><span class="o">)</span><span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="n">2</span> <span class="o">=</span><span class="o">=</span> <span class="n">0</span><span class="o">)</span><span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">i</span><span class="o">)</span><span class="o">;</span>
                <span class="n">sum</span> <span class="o">+</span><span class="o">=</span> <span class="n">i</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">sum</span><span class="o">;</span><span class="c1">//è‡ªåŠ¨è£…ç®±ï¼Œå˜ä¸ºIntegerç±»å‹
</span><span class="c1"></span>    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h4 id="çº¿ç¨‹æ± ">çº¿ç¨‹æ± </h4>
<p>çº¿ç¨‹æ± çš„å¥½å¤„</p>
<ul>
<li>æé«˜å“åº”é€Ÿåº¦ï¼Œå‡å°‘äº†åˆ›å»ºçº¿ç¨‹çš„æ—¶é—´</li>
<li>é™ä½èµ„æºæ¶ˆè€—ï¼Œé‡å¤åˆ©ç”¨çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹</li>
<li>ä¾¿äºçº¿ç¨‹ç®¡ç†</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreadPool</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[</span><span class="o">]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//åˆ›å»ºçº¿ç¨‹æ± 
</span><span class="c1"></span>        <span class="n">ExecutorService</span> <span class="n">service</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="n">10</span><span class="o">)</span><span class="o">;</span>

        <span class="n">service</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="o">(</span><span class="o">)</span> <span class="o">-</span><span class="o">&gt;</span> <span class="o">{</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">100</span><span class="o">;</span> <span class="n">i</span><span class="o">+</span><span class="o">+</span><span class="o">)</span><span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="n">2</span> <span class="o">=</span><span class="o">=</span> <span class="n">0</span><span class="o">)</span>
                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">(</span><span class="o">)</span><span class="o">.</span><span class="na">getName</span><span class="o">(</span><span class="o">)</span><span class="o">+</span><span class="s">&#34;:æ‰“å°-&#34;</span> <span class="o">+</span> <span class="n">i</span><span class="o">)</span><span class="o">;</span>
            <span class="o">}</span>

        <span class="o">}</span><span class="o">)</span><span class="o">;</span><span class="c1">//é€‚åˆä½¿ç”¨Runnableï¼Œæ²¡æœ‰è¿”å›å€¼
</span><span class="c1"></span>        <span class="n">Future</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">future</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="o">(</span><span class="o">)</span> <span class="o">-</span><span class="o">&gt;</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">100</span><span class="o">;</span> <span class="n">i</span><span class="o">+</span><span class="o">+</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="n">2</span> <span class="o">!</span><span class="o">=</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">sum</span> <span class="o">+</span><span class="o">=</span> <span class="n">i</span><span class="o">;</span>
                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">(</span><span class="o">)</span><span class="o">.</span><span class="na">getName</span><span class="o">(</span><span class="o">)</span> <span class="o">+</span> <span class="s">&#34;:æ‰“å°-&#34;</span> <span class="o">+</span> <span class="n">i</span><span class="o">)</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>

            <span class="k">return</span> <span class="n">sum</span><span class="o">;</span>
        <span class="o">}</span><span class="o">)</span><span class="o">;</span><span class="c1">//é€‚åˆä½¿ç”¨äºCallableï¼Œè¿”å›Future
</span><span class="c1"></span>
        <span class="n">Integer</span> <span class="n">integer</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">integer</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ExecutionException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">integer</span><span class="o">)</span><span class="o">;</span>

        <span class="c1">//å…³é—­çº¿ç¨‹æ± 
</span><span class="c1"></span>        <span class="n">service</span><span class="o">.</span><span class="na">shutdown</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>å¦‚æœéœ€è¦å¯¹çº¿ç¨‹æ± è¿›è¡Œè®¾ç½®çš„è¯ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ExecuteService å¯¹è±¡ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªæ¥å£
æˆ‘ä»¬å¯ä»¥å°†å®ƒè¿›è¡Œå¼ºè½¬ï¼ˆå‘ä¸‹è½¬å‹ï¼‰ï¼Œæ‰¾å®ƒçš„å®ç°ç±»ï¼ŒThreadPollExecutorï¼Œç„¶åè¿›è¡Œç›¸å…³è®¾ç½®</p>
</article><section class="article labels"><a class="category" href=/categories/java/>java</a><a class="tag" href=/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/>å¤šçº¿ç¨‹</a></section></div><section class="article navigation"><p><a class="link" href="/post/shiro2/"><span class="li">&rarr;</span>Shiro ä¸­ç®€å•çš„è®¤è¯å’Œè§’è‰²æƒé™ç®¡ç†</a></p></section></div><section id="footer" class="footer"><div class="footer-wrap">
    <p class="copyright">Â©2020 gejigejiemmm.</p>
    <p class="powerby"><span>Powered by </span><a href="https://gohugo.io" 
        target="_blank">Hugo</a><span> and the </span><a href="https://themes.gohugo.io/hugo-notepadium/" 
        target="_blank">Notepadium</a></p>
</div></section></div>
</body>

</html>